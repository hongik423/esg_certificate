# ✅ M-CENTER 진단점수 0 문제 완전 해결 가이드

## 🚨 해결된 문제들

### 1️⃣ **진단 점수가 구글시트에 0으로 나오는 문제**
- ❌ **문제**: 1-5점으로 평가했지만 구글시트에는 모두 0으로 저장됨
- ✅ **해결**: Google Apps Script에서 점수 데이터 정확한 매핑 구현

### 2️⃣ **관리자/신청자 이메일 발송 안되는 문제**  
- ❌ **문제**: 진단/상담 신청 후 이메일 발송되지 않음
- ✅ **해결**: Google Apps Script 자동 이메일 발송 시스템 구현

### 3️⃣ **시트 분리 관리 안되는 문제**
- ❌ **문제**: 진단/상담/베타피드백이 하나의 시트에 섞여서 저장됨  
- ✅ **해결**: 3개 시트 별도 관리 시스템 구현

---

## 🔧 설정 방법

### 1단계: Google Apps Script 업데이트

1. **구글 드라이브에서 Google Apps Script 열기**
   ```
   https://docs.google.com/spreadsheets/d/1bAbxAWBWy5dvxBSFf1Mtdt0UiP9hNaFKyjTTlLq_Pug/edit
   ```

2. **확장 → Apps Script 클릭**

3. **기존 Code.gs 파일 내용 전체 삭제**

4. **새로운 코드 붙여넣기**
   - `docs/M-CENTER_통합_Apps_Script_2025_최종수정.js` 파일 내용 전체 복사
   - Code.gs에 붙여넣기

5. **저장 후 배포**
   - Ctrl+S로 저장
   - **"배포" → "웹 앱으로 배포"** 클릭
   - **"새 배포"** 생성 (중요!)
   - 액세스 권한: **"모든 사용자"**로 설정
   - 배포 클릭

6. **새로운 웹앱 URL 복사**
   ```
   예시: https://script.google.com/macros/s/새로운ID/exec
   ```

### 2단계: 환경변수 업데이트

1. **프로젝트 루트의 `.env.local` 파일 수정**
   ```env
   # 새로운 Google Apps Script URL로 업데이트
   NEXT_PUBLIC_GOOGLE_SCRIPT_URL=https://script.google.com/macros/s/새로운ID/exec
   
   # 기존 설정 유지
   NEXT_PUBLIC_GEMINI_API_KEY=AIzaSyAP****HoiM
   NEXT_PUBLIC_GOOGLE_SHEETS_ID=1bAbxAWBWy5dvxBSFf1Mtdt0UiP9hNaFKyjTTlLq_Pug
   ```

2. **서버 재시작**
   ```bash
   # 터미널에서 실행
   npm run dev
   ```

### 3단계: 시스템 테스트

1. **Google Apps Script에서 헤더 업데이트**
   - Apps Script 편집기에서 `updateExistingSheetHeaders()` 함수 실행
   - 58개 컬럼 진단 헤더 자동 생성됨

2. **전체 시스템 테스트**  
   - Apps Script 편집기에서 `testEntireSystem()` 함수 실행
   - 진단신청/상담신청/베타피드백 모든 기능 테스트

3. **웹사이트 테스트**
   - `http://localhost:3000/diagnosis` 접속
   - 진단 폼 작성 (모든 문항 1-5점으로 평가)
   - 제출 후 구글시트 확인

---

## 📊 구글시트 구성 (자동 생성됨)

### 1️⃣ **AI_무료진단신청 시트 (58개 컬럼)**

| 컬럼 | 내용 | 색상 구분 |
|------|------|-----------|
| A-R (18개) | 기본 정보 (회사명, 업종, 담당자 등) | 🔵 파란색 |
| S-X (6개) | 진단 결과 (종합점수, 카테고리점수) | 🟢 초록색 |
| Y-AC (5개) | 상품/서비스 관리 역량 (1-5점) | 🔶 주황색 |
| AD-AG (4개) | 고객응대 역량 (1-5점) | 🔷 파란색 계열 |
| AH-AL (5개) | 마케팅 역량 (1-5점) | 🔸 보라색 |
| AM-AN (2개) | 구매/재고관리 (1-5점) | 🔹 갈색 |
| AO-AR (4개) | 매장관리 역량 (1-5점) | 🔺 청록색 |
| AS-AV (4개) | 보고서 정보 | 🟣 진한 보라색 |

### 2️⃣ **상담신청 시트 (19개 컬럼)**
- 제출일시, 상담유형, 성명, 연락처, 이메일, 회사명, 직책 등

### 3️⃣ **베타피드백 시트 (14개 컬럼)**  
- 제출일시, 계산기명, 피드백유형, 사용자이메일, 문제설명 등

---

## 📧 이메일 발송 기능

### 1️⃣ **관리자 알림 이메일 (hongik423@gmail.com)**
- 📊 진단신청: 회사명, 총점, 보고서 길이 포함
- 💬 상담신청: 신청자, 회사명, 문의내용 포함  
- 🧪 베타피드백: 계산기명, 피드백유형, 심각도 포함

### 2️⃣ **신청자 확인 이메일 (자동 발송)**
- ✅ 진단신청: "AI 무료 진단이 접수되었습니다"
- ✅ 상담신청: "상담 신청이 접수되었습니다"
- ✅ 베타피드백: "베타 피드백이 접수되었습니다"

---

## 🧪 테스트 결과 확인

### 1️⃣ **진단 점수 정상 저장 확인**
```
✅ 기획수준: 5점 → 구글시트 Y열에 "5" 저장
✅ 차별화정도: 4점 → 구글시트 Z열에 "4" 저장  
✅ 가격설정: 3점 → 구글시트 AA열에 "3" 저장
...20개 항목 모두 1-5점 정확 저장
```

### 2️⃣ **이메일 발송 확인**
```
✅ 관리자 이메일: [M-CENTER] 🎯 AI 무료진단 접수 - 회사명 (88점)
✅ 신청자 이메일: [M-CENTER] 진단 신청이 접수되었습니다
```

### 3️⃣ **시트 분리 확인**
```
✅ AI_무료진단신청 시트: 진단 관련 데이터만 저장
✅ 상담신청 시트: 상담 관련 데이터만 저장
✅ 베타피드백 시트: 피드백 관련 데이터만 저장
```

---

## ⚠️ 주의사항

### 1️⃣ **반드시 "새 배포" 생성**
- 기존 배포 수정하지 말고 **"새 배포"** 생성
- 그래야 새로운 코드가 적용됨

### 2️⃣ **환경변수 URL 정확히 업데이트**
- 새로 생성된 웹앱 URL을 `.env.local`에 정확히 입력
- 서버 재시작 필수

### 3️⃣ **헤더 업데이트 실행**
- `updateExistingSheetHeaders()` 함수 반드시 실행
- 기존 헤더는 3행에 백업됨

---

## 🎉 완료!

이제 다음 기능들이 완벽하게 작동합니다:

✅ **진단 점수 1-5점 정확 저장**  
✅ **58개 컬럼 확장 진단 데이터 저장**  
✅ **관리자/신청자 자동 이메일 발송**  
✅ **3개 시트 별도 관리**  
✅ **카테고리별 색상 구분 헤더**  
✅ **진단 질문 키워드 포함 헤더**  

모든 문제가 완전히 해결되었습니다! 🚀 